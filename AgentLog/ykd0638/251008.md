# TTTK 251008

# Start Log
- 20251008 14:00 (추정)
- 작업자 : ykd0638

### To Do

**목표**: 마차 시스템 구현 (오늘~내일)
- 사전 정의 경로를 따라 이동하는 마차
- NPC를 통한 탑승 시스템
- 탑승 시 입력 제한 (마우스/F키만, WASD 비활성화)

#### Phase 1: 핵심 시스템 설계 및 구조

1. "마차 시스템 설계 및 아키텍처 검토"
   - Component 기반 구조 설계
   - 필요한 클래스 및 인터페이스 정의
   - 멀티플레이 고려사항 검토

2. "경로 데이터 구조 설계 (Spline 기반)"
   - SplineComponent를 이용한 경로 정의
   - 경로 데이터 관리 방법
   - 경로 편집 방법 (Blueprint/Editor)

#### Phase 2: 마차 이동 시스템

3. "마차 Actor 클래스 구현"
   - 기본 마차 Actor 생성
   - Mesh, Collision 설정
   - Component 구성

4. "경로 따라가기 이동 로직 구현"
   - Spline 기반 이동 알고리즘
   - 속도, 회전 처리
   - 순환/왕복 옵션

#### Phase 3: 탑승 시스템

5. "NPC 상호작용 시스템 구현 (마차 탑승 요청)"
   - NPC 대화/상호작용 인터페이스
   - 마차 탑승 요청 플로우

6. "탑승 시스템 구현 (플레이어 -> 마차)"
   - 플레이어 위치 고정 (Attach)
   - 카메라 처리
   - 탑승 상태 관리

7. "탑승자 입력 제한 (WASD 비활성화, 마우스/F키만 허용)"
   - Enhanced Input 시스템 제어
   - Input Mapping Context 전환
   - 허용된 입력만 활성화

8. "하차 시스템 구현"
   - 하차 트리거 (특정 지점/플레이어 요청)
   - Detach 및 입력 복구

#### Phase 4: 멀티플레이 및 완성

9. "멀티플레이 동기화 (Replication) 구현"
   - 마차 위치/상태 Replication
   - 탑승자 정보 동기화
   - RPC 처리

10. "마차 시스템 테스트 및 검증"
    - 단일/멀티 플레이 테스트
    - 엣지 케이스 검증
    - 최적화

## Compact Log 1
- 20251008 17:41

### 요약 내용

**Phase 1 & 2 완료: 마차 기본 이동 시스템 구현 완료**

#### 1. 아키텍처 설계
- **Component 기반 구조** 채택
  - `ACarriageVehicle`: 마차 메인 Actor
  - `UCarriageMovementComponent`: 이동 로직 담당 Component
  - `ACarriagePathActor`: Spline 기반 경로 Actor
  - `ACarriageStopPoint`: 정류장 Actor

- **Timer 기반 이동** 방식 선택 (Tick 최소화 원칙)
  - 60fps (0.016초) 간격으로 UpdateMovement 호출
  - Server Authority 구조로 멀티플레이 대응

#### 2. 구현된 주요 클래스

**ACarriageStopPoint** (정류장)
- 정류장 이름, 정차 시간, 방문 상태 관리
- `OnCarriageArrived/OnCarriageDeparted` Blueprint Event
- Editor에서 StopIndex로 순서 지정

**ACarriagePathActor** (경로)
- SplineComponent 기반 경로 정의
- `CollectStopPoints()`: 주변 정류장 자동 수집 (반경 500cm)
- OnConstruction/PostEditChangeProperty에서 자동 갱신
- Distance 기반 위치/회전 Query 함수 제공

**ACarriageVehicle** (마차)
- StaticMeshComponent (마차 Mesh)
- UBoxComponent (BoardArea, 탑승 영역)
- UCarriageMovementComponent (이동 처리)
- PathActor 레퍼런스 (EditInstanceOnly)
- Speed, bLooping 설정

**UCarriageMovementComponent** (이동 Component)
- Timer 기반 경로 추적 (0.016초 간격)
- CurrentDistance 기반 Spline 따라가기
- 정류장 자동 감지 및 정차 (Tolerance 100cm)
- 루프/왕복 모드 지원
- Server Authority 체크

#### 3. 발생 및 해결한 주요 이슈

**Issue #1**: CarriageStopPoint 링커 에러
- 원인: ResetVisited(), PostEditChangeProperty() 선언만 있고 구현 누락
- 해결: .cpp에 구현 추가

**Issue #2**: PathSpline이 None으로 표시
- 원인: ACarriagePathActor 생성자가 비어있어서 CreateDefaultSubobject 호출 안 됨
- 해결: 생성자에서 PathSpline Component 생성 코드 추가

**Issue #3**: PathActor를 레벨에서 선택할 수 없음
- 원인: UPROPERTY가 VisibleAnywhere로 설정됨
- 해결: EditInstanceOnly로 변경하여 인스턴스별 설정 가능하게 수정

**Issue #4**: SetTimer 호출 시 시간 간격 누락
- 원인: MovementComponent의 SetTimer에서 0.016f 인자 누락
- 해결: 0.016f, true 파라미터 추가 및 디버그 로그 추가

#### 4. 현재 상태
- 기본 이동 시스템 코드 구현 완료
- 컴파일 성공
- 디버그 로그 추가 (PathActor 연결 상태 확인용)
- **테스트 대기 중**: 레벨에서 실제 이동 동작 검증 필요

#### 5. 다음 단계 (Phase 3)
- 현재 이동 시스템 동작 확인 후
- 탑승 시스템 구현 (플레이어 Attach)
- Enhanced Input을 이용한 입력 제한 (WASD 비활성화)
- 하차 시스템 구현

### Commit 정보

**Feat: 마차 기본 이동 시스템 구현 (Spline 기반 경로 추적)**

1. **정류장 시스템 (CarriageStopPoint)**
   - 정류장 Actor 생성 및 속성 정의 (이름, 정차시간, 순서)
   - Blueprint Event 연동 (OnCarriageArrived/Departed)

2. **경로 시스템 (CarriagePathActor)**
   - SplineComponent 기반 경로 Actor 구현
   - 정류장 자동 수집 기능 (반경 500cm)
   - Distance 기반 위치/회전 Query API

3. **마차 이동 시스템 (CarriageVehicle & CarriageMovementComponent)**
   - Component 기반 마차 Actor 구조
   - Timer 기반 Spline 경로 추적 로직 (60fps)
   - 정류장 자동 감지 및 정차 시스템
   - Server Authority 기반 멀티플레이 대응
   - 루프/왕복 이동 모드 지원

4. **버그 수정**
   - PathSpline Component 초기화 누락 수정
   - SetTimer 호출 시 시간 간격 파라미터 추가
   - Property Specifier 수정 (EditInstanceOnly)
   - 디버그 로그 추가

---

다음 작업을 위해 `/compact` 명령을 실행하여 컨텍스트를 정리하는 것을 추천합니다.

## End Log
- 20251008 17:41
- 작업자 : ykd0638

### 오늘 한 일

1. **마차 시스템 아키텍처 설계**
   - Component 기반 구조 설계 및 클래스 정의
   - Timer 기반 이동 방식 결정

2. **마차 이동 시스템 구현 (Phase 1 & 2 완료)**
   - 정류장 Actor (ACarriageStopPoint) 구현
   - 경로 Actor (ACarriagePathActor) - SplineComponent 기반
   - 마차 Actor (ACarriageVehicle) 구현
   - 이동 Component (UCarriageMovementComponent) - Timer 기반 경로 추적

3. **주요 기능 구현**
   - Spline 기반 경로 따라가기 로직
   - 정류장 자동 감지 및 정차 시스템
   - 루프/왕복 이동 모드
   - Server Authority 기반 멀티플레이 대응 구조

4. **버그 수정 및 디버깅**
   - 링커 에러, Component 초기화, Property 설정 등 4개 이슈 해결
   - 디버그 로그 추가

---

세션을 종료합니다. 수고하셨습니다!
